"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ODAction = exports.ODActionManager = exports.ODActionImplementation = void 0;
///////////////////////////////////////
//ACTION MODULE
///////////////////////////////////////
const base_1 = require("./base");
const worker_1 = require("./worker");
/**## ODActionImplementation `class`
 * This is an Open Ticket action implementation.
 *
 * It is a basic implementation of the `ODWorkerManager` used by all `ODAction` classes.
 *
 * This class can't be used stand-alone & needs to be extended from!
 */
class ODActionImplementation extends base_1.ODManagerData {
    /**The manager that has all workers of this implementation */
    workers;
    constructor(id, callback, priority, callbackId) {
        super(id);
        this.workers = new worker_1.ODWorkerManager("descending");
        if (callback)
            this.workers.add(new worker_1.ODWorker(callbackId ? callbackId : id, priority ?? 0, callback));
    }
    /**Execute all workers & return the result. */
    async run(source, params) {
        throw new base_1.ODSystemError("Tried to build an unimplemented ODResponderImplementation");
    }
}
exports.ODActionImplementation = ODActionImplementation;
/**## ODActionManager `class`
 * This is an Open Ticket action manager.
 *
 * It contains all Open Ticket actions. You can compare actions with some sort of "procedure".
 * It's a complicated task that is divided into multiple functions.
 *
 * Some examples are `ticket-creation`, `ticket-closing`, `ticket-claiming`, ...
 *
 * It's recommended to use this system in combination with Open Ticket responders!
 */
class ODActionManager extends base_1.ODManager {
    constructor(debug) {
        super(debug, "action");
    }
}
exports.ODActionManager = ODActionManager;
class ODAction extends ODActionImplementation {
    /**Run this action */
    async run(source, params) {
        //create instance
        const instance = {};
        //wait for workers to finish
        await this.workers.executeWorkers(instance, source, params);
        //return data generated by workers
        return instance;
    }
}
exports.ODAction = ODAction;
